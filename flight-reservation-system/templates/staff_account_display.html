{% extends "base.html" %}

{% block content %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

<div class="container" style="margin-top: 5%;">
    <div class="row align-items-center">
      <div class="col-auto">
        <i class="bi-person" style="font-size: 4rem;"></i>
      </div>
      <div class="col">
        <h3>{% if session['user_type'] == 'booking_agent'%}Booking Agent #{% endif %}{{ session['name'] }}</h3>
        {% if session['user_type'] == 'customer' %}
            <p class="text-muted">Customer account</p>
        {% elif session['user_type'] == 'booking_agent' %}
            <p class="text-muted">Agent account</p>
        {% elif session['user_type'] == 'airline_staff' and session['permission'] == 'admin'%}
            <p class="text-muted">Staff account <span class="badge rounded-pill bg-success">Admin</span></p>
         
        {% elif session['user_type'] == 'airline_staff' %}
            <p class="text-muted">Staff account</p>
        {% endif %}
        
      </div>
    </div>
</div>


<div class="container" style="margin-top: 20px;">
    <div class="row">
        <div class="col-3">
          <div class="list-group" id="list-tab" role="tablist">
              <a class="list-group-item list-group-item-action active" id="list-profile-list" data-bs-toggle="list" href="#list-profile" role="tab" aria-controls="list-profile"><i class="bi-person-fill" style="font-size: 1.1rem;"></i>  Profile</a>
              <a class="list-group-item list-group-item-action" id="list-spending-list" data-bs-toggle="list" href="#list-flights" role="tab" aria-controls="list-flights"><i class="bi-airplane-fill" style="font-size: 1rem;"></i>  Flights</a>
              <a class="list-group-item list-group-item-action" id="list-agents-list" data-bs-toggle="list" href="#list-agents" role="tab" aria-controls="list-agents"><i class="bi-person-badge-fill" style="font-size: 1rem;"></i>  Agents</a>
              <a class="list-group-item list-group-item-action" id="list-settings-list" data-bs-toggle="list" href="#list-customers" role="tab" aria-controls="list-settings"><i class="bi-person-vcard-fill" style="font-size: 1rem;"></i>  Customers</a>
              <a class="list-group-item list-group-item-action" id="list-settings-list" data-bs-toggle="list" href="#list-sales-report" role="tab" aria-controls="list-settings"><i class="bi-bar-chart-fill" style="font-size: 1rem;"></i>  Sales Report</a>
              <a class="list-group-item list-group-item-action" id="list-settings-list" data-bs-toggle="list" href="#list-revenue-report" role="tab" aria-controls="list-settings"><i class="bi-pie-chart-fill" style="font-size: 1rem;"></i>  Revenue Report</a>
              <a class="list-group-item list-group-item-action" id="list-settings-list" data-bs-toggle="list" href="#list-destinations" role="tab" aria-controls="list-settings"><i class="bi-pin-map-fill" style="font-size: 1rem;"></i>  Destinations</a> 
          </div>
        </div>
        <div class="col-9">
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
              <div class="container rounded">
                {% if data %}
                    <h4>Airline Affiliation: {{ data.airline_name }}</h4>
                    <h4>Username: {{ data.username }}</h4>
                    <h4>First Name: {{ data.first_name }}</h4>
                    <h4>Last Name: {{ data.last_name }}</h4>
                {% endif %}
              </div>
            </div>


            <div class="tab-pane fade" id="list-flights" role="tabpanel" aria-labelledby="list-flights-list">
                <div class="container">
                    <div class="row">
                    <div class="col">
                        <h4>Upcoming Flights</h4>
                        <table class="table table-striped">
                        <thead>
                            <tr>
                            <th scope="col">Flight Number</th>
                            <th scope="col">Departure Airport</th>
                            <th scope="col">Arrival Airport</th>
                            <th scope="col">Departure Time</th>
                            <th scope="col">Arrival Time</th>
                            <th scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if flights %}
                            {% for entry in flights %}
                                {% if entry.status == "On time" or entry.status == "Delayed" %}
                                <tr>
                                    <th scope="row">{{ entry.flight_num }}</th>
                                    <td>{{ entry.departure_airport }}</td>
                                    <td>{{ entry.arrival_airport }}</td>
                                    <td>{{ entry.departure_time }}</td>
                                    <td>{{ entry.arrival_time }}</td>
                                    <td>{{ entry.status }}</td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                            {% endif %}
                        </tbody>
                        </table>
                    </div>
                    <div class="col">
                        <h4>Previous Flights</h4>
                        <table class="table table-striped">
                        <thead>
                            <tr>
                            <th scope="col">Flight Number</th>
                            <th scope="col">Departure Airport</th>
                            <th scope="col">Arrival Airport</th>
                            <th scope="col">Departure Time</th>
                            <th scope="col">Arrival Time</th>
                            <th scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if flights %}
                            {% for entry in flights %}
                                {% if entry.status == "In flight" %}
                                <tr>
                                    <th scope="row">{{ entry.flight_num }}</th>
                                    <td>{{ entry.departure_airport }}</td>
                                    <td>{{ entry.arrival_airport }}</td>
                                    <td>{{ entry.departure_time }}</td>
                                    <td>{{ entry.arrival_time }}</td>
                                    <td>{{ entry.status }}</td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                            {% endif %}
                        </tbody>
                        </table>
                    </div>
                  </div>
                </div>
            </div>


            <div class="tab-pane fade" id="list-agents" role="tabpanel" aria-labelledby="list-settings-list">
                {% if agents %}
                    <div class="table-responsive">
                      <table id="agentTable" class="table table-striped">
                        <thead>
                          <tr>
                            <th>Booking Agent ID</th>
                            <th>Email</th>
                            <th><i class="bi-funnel-fill" style="font-size: 1rem;"></i> Sales MTD</th>
                            <th><i class="bi-funnel-fill" style="font-size: 1rem;"></i> Sales YTD</th>
                            <th><i class="bi-funnel-fill" style="font-size: 1rem;"></i> Commissions YTD</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for agent in agents %}
                          <tr>
                            <td>{{ agent.booking_agent_id }}</td>
                            <td>{{ agent.email }}</td>
                            <td>{{ agent.sales_past_month }}</td>
                            <td>{{ agent.sales_past_year }}</td>
                            <td>{{ agent.past_year_commissions }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                {% else %}
                    <h4>No booking agent sales found.</h4>
                {% endif %}
            </div>
            <div class="tab-pane fade" id="list-customers" role="tabpanel" aria-labelledby="list-customers-list">
              <div class="container">
                <h3>Customer History Lookup</h3>
                <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="Customer's email" aria-label="Recipient's username" aria-describedby="button-addon2">
                  <button class="btn btn-outline-secondary" type="button" id="button-addon2">Search</button>
                </div>
              </div>
                {% if customers %}
                  <h4>Top Customers</h4>
                    <div class="table-responsive">
                      <table id="agentTable" class="table table-striped">
                        <thead>
                          <tr>
                            <th>Email</th>
                            <th>Name</th>
                            <th><i class="bi-funnel-fill" style="font-size: 1rem;"></i> Tickets Purchased</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for customer in customers %}
                          <tr>
                            <td>{{ customer.email }}</td>
                            <td>{{ customer.name }}</td>
                            <td>{{ customer.tickets_purchased }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                {% else %}
                    <h4 class="text-muted">No customers found.</h4>
                {% endif %}
            </div>
            <div class="tab-pane fade" id="list-sales-report" role="tabpanel" aria-labelledby="list-settings-list"></div>
            <div class="tab-pane fade" id="list-revenue-report" role="tabpanel" aria-labelledby="list-messages-list"></div>
            <div class="tab-pane fade" id="list-destinations" role="tabpanel" aria-labelledby="list-settings-list"></div>
          </div>
        </div>
      </div>  
  </div>

  <script>
    // jQuery code to activate the "Flights" tab by default
    $(document).ready(function() {
        var activeTab = "list-flights"
      // Use the tab's href attribute to identify the "Flights" tab
      if (activeTab) {
        $('a[href="#' + activeTab + '"]').tab('show');
      }
    });

    $(document).ready(function () {
            $('#agentTable').DataTable({
                
            });
        });
  </script>
  


{% endblock %}

{% block footer %}
{% endblock %}